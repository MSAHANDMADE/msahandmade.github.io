<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CoÈ™ â€” MSA Handmade</title>

  <!-- SEO -->
  <meta name="description" content="FinalizeazÄƒ comanda la MSA Handmade. CoÈ™ul tÄƒu, datele de livrare È™i trimiterea comenzii." />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://msahandmade.ro/cos.html" />
  <link rel="alternate" hreflang="ro" href="https://msahandmade.ro/cos.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="MSA Handmade" />
  <meta property="og:title" content="CoÈ™ â€” MSA Handmade" />
  <meta property="og:description" content="VerificÄƒ produsele din coÈ™ È™i plaseazÄƒ comanda." />
  <meta property="og:url" content="https://msahandmade.ro/cos.html" />
  <meta property="og:image" content="https://msahandmade.ro/logo.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="CoÈ™ â€” MSA Handmade" />
  <meta name="twitter:description" content="FinalizeazÄƒ comanda MSA Handmade." />
  <meta name="twitter:image" content="https://msahandmade.ro/logo.png" />

  <link rel="stylesheet" href="styles.css" />
  <style>
    .container{max-width:1000px;margin:0 auto;padding:20px}
    .cart-grid{display:grid;grid-template-columns:1fr;gap:18px}
    .totals{display:flex;gap:14px;flex-wrap:wrap;margin:10px 0}
    .chip{background:#f3f4f6;border-radius:10px;padding:8px 12px}
    .line{display:flex;align-items:center;gap:10px;padding:12px;border:1px solid #eee;border-radius:14px}
    .line img{width:64px;height:64px;object-fit:cover;border-radius:10px;background:#fafafa}
    .qty{display:flex;align-items:center;gap:8px}
    .qty button{width:32px;height:32px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .remove{border:0;background:#fee2e2;color:#991b1b;border-radius:10px;padding:8px 10px;cursor:pointer}
    .right{margin-left:auto;font-weight:600}
    .section{background:#fff;border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:18px}
    .btn{display:inline-block;background:#111827;color:#fff;border:0;border-radius:12px;padding:12px 18px;cursor:pointer}
    .btn-secondary{background:#f3f4f6;color:#111827}
    fieldset{border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin:10px 0}
    legend{padding:0 8px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    label{font-size:14px;color:#374151}
    input, textarea, select{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:10px}
    textarea{min-height:110px}
    @media(min-width:768px){
      .grid-2{grid-template-columns:1fr 1fr}
      .totals{justify-content:flex-start}
    }
  </style>
</head>
<body>
<header class="header">
  <nav class="nav">
    <a href="index.html">AcasÄƒ</a>
    <a href="produse.html">Produse</a>
    <a href="contact.html">Contact</a>
    <a href="cos.html" class="cart">ðŸ›’ <span id="cart-count">0</span></a>
  </nav>
</header>

<main class="container">
  <h1 style="margin:14px 0 6px">CoÈ™ul tÄƒu</h1>

  <!-- Totaluri sus -->
  <div class="totals">
    <span class="chip">Subtotal: <b id="subtotal">0 RON</b></span>
    <span class="chip">Reducere: <b id="reducere">0 RON</b></span>
    <span class="chip">Livrare: <b id="shipping">0 RON</b></span>
    <span class="chip">Total: <b id="total">0 RON</b></span>
  </div>

  <!-- Discount procente -->
  <div class="section" style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
    <label for="discount">Reducere (%):</label>
    <select id="discount">
      <option value="0">0%</option>
      <option value="10">10%</option>
      <option value="15">15%</option>
      <option value="20">20%</option>
    </select>
    <button id="apply-discount" class="btn">AplicÄƒ</button>
    <small style="color:#6b7280">Reducerea se aplicÄƒ la subtotal (fÄƒrÄƒ livrare).</small>
  </div>

  <!-- Linii coÈ™ -->
  <div id="cart-lines" class="cart-grid section"></div>

  <!-- Form comanda -->
  <form id="order-form" class="section" autocomplete="on">
    <fieldset>
      <legend>Tip client</legend>
      <label style="display:inline-flex;gap:8px;margin-right:16px">
        <input type="radio" name="tip" value="PersoanÄƒ fizicÄƒ" checked /> PersoanÄƒ fizicÄƒ
      </label>
      <label style="display:inline-flex;gap:8px">
        <input type="radio" name="tip" value="PersoanÄƒ juridicÄƒ" /> PersoanÄƒ juridicÄƒ
      </label>
    </fieldset>

    <div class="grid grid-2">
      <div>
        <label>Nume</label>
        <input name="nume" required />
      </div>
      <div>
        <label>Prenume</label>
        <input name="prenume" required />
      </div>
      <div>
        <label>Email</label>
        <input name="email" type="email" required />
      </div>
      <div>
        <label>Telefon</label>
        <input name="telefon" required />
      </div>
      <div>
        <label>JudeÈ›</label>
        <input name="judet" required />
      </div>
      <div>
        <label>OraÈ™</label>
        <input name="oras" required />
      </div>
      <div>
        <label>Cod poÈ™tal</label>
        <input name="codpostal" required />
      </div>
      <div>
        <label>AdresÄƒ</label>
        <input name="adresa" required />
      </div>
    </div>

    <div style="margin-top:12px">
      <label>MenÈ›iuni (opÈ›ional)</label>
      <textarea name="mentiuni"></textarea>
    </div>

    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:14px">
      <button type="button" id="clear" class="btn btn-secondary">GoleÈ™te coÈ™ul</button>
      <button type="submit" class="btn">PlaseazÄƒ comanda</button>
    </div>
  </form>
</main>

<footer class="footer" style="text-align:center; margin-top:26px; padding:20px; color:#666;">
  <small>&copy; <span id="year"></span> â€” MSA Handmade.</small>
</footer>

<!-- IMPORTANT: doar cart.js -->
<script src="cart.js"></script>
<script>
  // anul curent
  document.getElementById('year').textContent = new Date().getFullYear();

  // util: format bani
  const money = v => `${(Math.round((v ?? 0) * 100)/100).toFixed(2)} RON`;

  // badge global coÈ™
  function refreshBadge() {
    try{
      const list = (window.MSACart && typeof MSACart.readCart==='function') ? MSACart.readCart() : [];
      const count = list.reduce((s,i)=> s + (i.qty||1), 0);
      const el = document.getElementById('cart-count');
      if (el) el.textContent = count;
    } catch(e){}
  }

  // randare linii coÈ™
  function renderCart(){
    const wrap = document.getElementById('cart-lines');
    wrap.innerHTML = "";
    const list = (window.MSACart && MSACart.readCart) ? MSACart.readCart() : [];

    if (!list.length){
      wrap.innerHTML = '<p style="margin:0;color:#6b7280">CoÈ™ul tÄƒu este gol.</p>';
    } else {
      list.forEach((p, idx)=>{
        const line = document.createElement('div');
        line.className = 'line';
        line.innerHTML = `
          <img src="${p.image || 'logo.png'}" alt="${p.name||''}">
          <div>
            <div style="font-weight:600">${p.name||''}</div>
            <div style="color:#6b7280">${money(p.price||0)}</div>
          </div>
          <div class="qty" style="margin-left:auto">
            <button aria-label="Minus" data-act="minus" data-id="${idx}">âˆ’</button>
            <input value="${p.qty||1}" readonly style="width:48px;text-align:center;border:1px solid #e5e7eb;border-radius:8px;padding:6px;background:#fff"/>
            <button aria-label="Plus" data-act="plus" data-id="${idx}">+</button>
          </div>
          <button class="remove" data-act="remove" data-id="${idx}">È˜terge</button>
        `;
        wrap.appendChild(line);
      });
    }

    // totals
    const t = (window.MSACart && MSACart.computeTotals) ? MSACart.computeTotals(list) : {subtotal:0,discount:0,shipping:0,total:0};
    document.getElementById('subtotal').textContent = money(t.subtotal);
    document.getElementById('reducere').textContent = money(t.discount);
    document.getElementById('shipping').textContent = money(t.shipping);
    document.getElementById('total').textContent = money(t.total);

    refreshBadge();
  }

  // click pe plus / minus / remove
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const act = btn.dataset.act;
    const id  = btn.dataset.id;
    if (act === 'plus'){ window.MSACart && MSACart.increaseQty(Number(id)); renderCart(); }
    if (act === 'minus'){ window.MSACart && MSACart.decreaseQty(Number(id)); renderCart(); }
    if (act === 'remove'){ window.MSACart && MSACart.removeFromCart(Number(id)); renderCart(); }
  });

  // aplicÄƒ reducere procent
  document.getElementById('apply-discount').addEventListener('click', ()=>{
    const pct = Number(document.getElementById('discount').value) || 0;
    if (window.MSACart && MSACart.setDiscountPct){ MSACart.setDiscountPct(pct); }
    renderCart();
  });

  // goleÈ™te coÈ™
  document.getElementById('clear').addEventListener('click', ()=>{
    if (window.MSACart && MSACart.clearCart){ MSACart.clearCart(); }
    renderCart();
  });

  // submit comandÄƒ â€” folosim FormData pe formularul corect
  document.getElementById('order-form').addEventListener('submit', async (ev)=>{
    ev.preventDefault();
    try{
      if (!window.MSACart || typeof MSACart.submitOrder!=='function'){
        throw new Error("Cart indisponibil");
      }
      const ok = await MSACart.submitOrder(new FormData(ev.currentTarget));
      if (ok) { window.location.href = 'multumesc.html'; }
    }catch(err){
      alert('Eroare la trimitere: ' + (err?.message || err));
    }
  });

  // porneÈ™te
  renderCart();
</script>
</body>
</html>
