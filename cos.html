<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CoÈ™ â€” MSA Handmade</title>
<link rel="stylesheet" href="styles.css" />
<style>
  :root{--ink:#0b132b;--muted:#64748b;--line:#e5e7eb;--card:#fff;--brand:#0b132b}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#fafafa;color:var(--ink)}
  a{text-decoration:none;color:inherit}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  header.nav{display:flex;gap:18px;align-items:center;justify-content:space-between;padding:12px 0}
  nav a{font-weight:700;margin-right:18px}
  .pill{background:#fde68a;border-radius:999px;padding:4px 10px;font-weight:800}
  h1{font-size:clamp(28px,4vw,40px);margin:8px 0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 4px 18px rgba(2,8,23,.06);padding:16px}

  /* â€”â€”â€” TABEL COÈ˜ â€”â€”â€” */
  .tbl-wrap{overflow-x:auto}
  table.cart{width:100%;border-collapse:collapse;table-layout:auto}
  table.cart th,table.cart td{padding:12px;border-bottom:1px solid var(--line);vertical-align:middle}
  table.cart th{background:#f8fafc;text-align:left;white-space:nowrap}
  /* Nume produs se poate rupe pe 2 rÃ¢nduri */
  table.cart td:nth-child(1){max-width:0}
  table.cart td:nth-child(1) .name{display:block;line-height:1.25;word-break:break-word}
  /* Cant. È™i Total au lÄƒÈ›ime minimÄƒ ca sÄƒ se vadÄƒ pe mobil */
  table.cart th:nth-child(2), table.cart td:nth-child(2){min-width:150px;white-space:nowrap;text-align:center}
  table.cart th:nth-child(3), table.cart td:nth-child(3){min-width:110px;white-space:nowrap;text-align:right}

  /* Cantitate â€” mare È™i clar */
  .qty{display:inline-flex;align-items:center;border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .qty button{width:42px;height:42px;border:0;background:#f1f5f9;font-size:22px;font-weight:800;line-height:1;cursor:pointer}
  .qty input{width:66px;height:42px;border:0;text-align:center;font-weight:800;font-size:18px}
  @media (max-width:420px){
    .qty button{width:36px;height:36px;font-size:20px}
    .qty input{width:54px;height:36px;font-size:16px}
    table.cart th:nth-child(2), table.cart td:nth-child(2){min-width:130px}
    table.cart th:nth-child(3), table.cart td:nth-child(3){min-width:96px}
  }

  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
  .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:#fff;font-weight:700;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;border-color:transparent}
  .btn.danger{background:#fee2e2;color:#991b1b;border-color:#fecaca}
  .btn[disabled]{opacity:.55;pointer-events:none}

  /* â€”â€”â€” TOTALURI â€”â€”â€” */
  .totals{display:grid;gap:8px}
  .row{display:flex;justify-content:space-between}
  .grand{font-weight:900;font-size:22px}

  /* â€”â€”â€” FORMULAR â€”â€”â€” */
  form input, form textarea{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font-size:16px;margin-bottom:10px;background:#fff}
  .switch{display:flex;gap:18px;margin:6px 0 12px}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:700px){.two{grid-template-columns:1fr}}
  .pf-only{display:block}
  .pj-only{display:none}
</style>
</head>
<body>
<div class="wrap">
  <!-- NAV -->
  <header class="nav">
    <nav>
      <a href="index.html">AcasÄƒ</a>
      <a href="produse.html">Produse</a>
      <a href="despre.html">Despre</a>
      <a href="contact.html">Contact</a>
    </nav>
    <a href="cos.html" aria-label="CoÈ™">ðŸ›’ <span id="cart-count" class="pill">0</span></a>
  </header>

  <h1>CoÈ™ul tÄƒu</h1>

  <!-- LISTÄ‚ PRODUSE -->
  <section class="card">
    <div class="tbl-wrap">
      <table class="cart" aria-label="Produse Ã®n coÈ™">
        <thead>
          <tr>
            <th>Produs</th>
            <th style="text-align:center">Cant.</th>
            <th style="text-align:right">Total</th>
          </tr>
        </thead>
        <tbody id="cart-body">
          <!-- Scriptul va popula aici -->
          <tr><td colspan="3" class="muted">Se Ã®ncarcÄƒâ€¦</td></tr>
        </tbody>
      </table>
    </div>

    <div class="actions">
      <button id="clear-cart" class="btn danger" type="button">GoleÈ™te coÈ™ul</button>
      <a class="btn" href="produse.html">ContinuÄƒ cumpÄƒrÄƒturile</a>
    </div>
  </section>

  <!-- TOTALURI (ID-urile clasice) -->
  <section class="card" style="margin-top:16px">
    <h2 style="margin:0 0 8px">Totaluri</h2>
    <div class="totals">
      <div class="row"><span>Subtotal</span><span id="subval">0.00 RON</span></div>
      <div class="row"><span>Reducere</span><span id="discval">âˆ’ 0.00 RON</span></div>
      <div class="row"><span>Livrare</span><span id="shipval">0.00 RON</span></div>
      <hr />
      <div class="row grand"><span>Total</span><span id="totval">0.00 RON</span></div>
    </div>
    <p class="muted" style="margin-top:8px">Reduceri: â‰¥200 RON âˆ’10%, â‰¥300 RON âˆ’15%, â‰¥400 RON âˆ’20%. Livrare gratuitÄƒ la 300 RON.</p>
  </section>

  <!-- FORMULAR (aceleaÈ™i ID/NAME pe care le foloseÈ™ti deja) -->
  <section class="card" style="margin-top:16px">
    <h2 style="margin:0 0 8px">Detalii pentru livrare</h2>

    <form id="order-form">
      <div class="switch">
        <label><input type="radio" name="tip" value="pf" checked> PersoanÄƒ fizicÄƒ</label>
        <label><input type="radio" name="tip" value="pj"> PersoanÄƒ juridicÄƒ</label>
      </div>

      <!-- PF -->
      <div class="pf-only two">
        <input id="nume"    name="nume"    placeholder="Nume" required>
        <input id="prenume" name="prenume" placeholder="Prenume" required>
      </div>

      <!-- PJ -->
      <div class="pj-only" id="pj-box">
        <input id="firma" name="firma" placeholder="Denumire firmÄƒ">
        <div class="two">
          <input id="cui"   name="cui"   placeholder="CUI">
          <input id="reg"   name="reg"   placeholder="Nr. Reg. ComerÈ›">
        </div>
      </div>

      <div class="two">
        <input id="email"   name="email"   placeholder="Email" required>
        <input id="telefon" name="telefon" placeholder="Telefon" required>
      </div>
      <div class="two">
        <input id="judet"   name="judet"   placeholder="JudeÈ›" required>
        <input id="oras"    name="oras"    placeholder="OraÈ™" required>
      </div>
      <input id="adresa"  name="adresa"  placeholder="AdresÄƒ completÄƒ" required>
      <input id="zip"     name="zip"     placeholder="Cod poÈ™tal">
      <textarea id="mentiuni" name="mentiuni" placeholder="MenÈ›iuni (opÈ›ional)" rows="3"></textarea>

      <button id="place-order" type="submit" class="btn primary" style="width:100%;margin-top:8px">
        PlaseazÄƒ comanda
      </button>
    </form>
  </section>

  <footer style="text-align:center;margin:26px 0;color:#6b7280">
    Â© <span id="year"></span> â€” MSA Handmade. Toate drepturile rezervate.
  </footer>
</div>

<!-- (1) DacÄƒ ai scriptul tÄƒu, Ã®l laÈ™i. DacÄƒ nu, codul de mai jos este autosuficient. -->
<script>
/* ====== CART CORE (nu atinge EmailJS/proforma; doar coÈ™ul) ====== */
(function(){
  const KEY = 'MSA_CART'; // aceeaÈ™i cheie pe care o foloseÈ™te Produse prin MSACart
  const $ = sel => document.querySelector(sel);

  // dacÄƒ existÄƒ MSACart (din produsele.html), Ã®l folosim; altfel fallback localStorage
  const api = window.MSACart ? {
    get: () => (window.MSACart.getItems ? window.MSACart.getItems() : readLS()),
    set: (arr) => (window.MSACart.setItems ? window.MSACart.setItems(arr) : writeLS(arr)),
    add: (it,qty=1) => (window.MSACart.addToCart ? window.MSACart.addToCart(it,qty) : addLS(it,qty)),
    upd: (id,qty) => (window.MSACart.updateQty ? window.MSACart.updateQty(id,qty) : updLS(id,qty)),
    del: (id) => (window.MSACart.remove ? window.MSACart.remove(id) : delLS(id)),
    clr: () => (window.MSACart.clear ? window.MSACart.clear() : clearLS())
  } : {
    get: readLS, set: writeLS, add: addLS, upd: updLS, del: delLS, clr: clearLS
  };

  function readLS(){
    try{ const raw=localStorage.getItem(KEY); const a=raw?JSON.parse(raw):[]; return Array.isArray(a)?a:[] }catch(_){return []}
  }
  function writeLS(a){ try{ localStorage.setItem(KEY, JSON.stringify(a||[])); }catch(_){}
    updateBadge(); updateTotals(); }
  function addLS(it,qty){
    if(!it||!it.id) return; const q=Number(qty||1)||1;
    const items=readLS(); const i=items.findIndex(x=>x.id===it.id);
    if(i>=0){ items[i].qty=(Number(items[i].qty)||1)+q; }
    else{ items.push({ id:String(it.id), name:it.name||'', price:Number(it.price)||0, image:it.image||'', qty:q }); }
    writeLS(items);
  }
  function updLS(id,qty){
    const items=readLS(); const it=items.find(x=>x.id===id); if(!it) return;
    it.qty=Math.max(1,Number(qty)||1); writeLS(items);
  }
  function delLS(id){ writeLS(readLS().filter(x=>x.id!==id)); }
  function clearLS(){ writeLS([]); }

  function formatRON(x){ return (Number(x)||0).toFixed(2)+' RON'; }
  function sums(items){
    const sub = items.reduce((s,x)=>s+(Number(x.price)||0)*(Number(x.qty)||1),0);
    let disc=0; if(sub>=400) disc=sub*0.20; else if(sub>=300) disc=sub*0.15; else if(sub>=200) disc=sub*0.10;
    const ship = (sub-disc)>=300 ? 0 : 0;
    const tot = Math.max(0, sub-disc+ship);
    return {sub,disc,ship,tot};
  }

  function render(){
    const tb = $('#cart-body'); if(!tb) return;
    const items = api.get();
    tb.innerHTML = '';
    if(!items.length){
      tb.innerHTML = '<tr><td colspan="3" class="muted">CoÈ™ul este gol.</td></tr>';
      updateTotals(); updateBadge(); return;
    }
    items.forEach(it=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <span class="name">${it.name||''}</span>
          <div class="price" style="margin-top:4px">${formatRON(it.price||0)}</div>
        </td>
        <td style="text-align:center">
          <div class="qty">
            <button class="qminus" aria-label="Scade">âˆ’</button>
            <input type="number" min="1" value="${Number(it.qty)||1}" />
            <button class="qplus" aria-label="CreÈ™te">+</button>
          </div>
        </td>
        <td style="text-align:right"><strong>${formatRON((it.price||0)*(it.qty||1))}</strong></td>
      `;
      // evenimente qty
      const input = tr.querySelector('input');
      const minus = tr.querySelector('.qminus');
      const plus  = tr.querySelector('.qplus');
      minus.addEventListener('click', ()=>{ const v=Math.max(1,(Number(input.value)||1)-1); input.value=v; api.upd(it.id,v); render(); });
      plus .addEventListener('click', ()=>{ const v=(Number(input.value)||1)+1; input.value=v; api.upd(it.id,v); render(); });
      input.addEventListener('change', ()=>{ const v=Math.max(1,Number(input.value)||1); api.upd(it.id,v); render(); });

      tb.appendChild(tr);
    });
    updateTotals(); updateBadge();
  }

  function updateTotals(){
    const items = api.get();
    const t = sums(items);
    const $id = id => document.getElementById(id);
    if($id('subval')) $id('subval').textContent = formatRON(t.sub);
    if($id('discval')) $id('discval').textContent = 'âˆ’ '+formatRON(t.disc);
    if($id('shipval')) $id('shipval').textContent = formatRON(t.ship);
    if($id('totval')) $id('totval').textContent = formatRON(t.tot);
  }
  function updateBadge(){
    const el = document.getElementById('cart-count'); if(!el) return;
    const items = api.get(); const c = items.reduce((s,x)=>s+(Number(x.qty)||1),0);
    el.textContent = c;
  }

  // butoane globale
  document.getElementById('clear-cart')?.addEventListener('click', ()=>{ api.clr(); render(); });
  window.addEventListener('storage', e=>{ if(e.key===KEY) render(); });

  // init
  document.addEventListener('DOMContentLoaded', ()=>{ render(); });
})();
</script>

<!-- (2) Utilitare locale: an, PF/PJ toggle, blocare dublu-submit (NU ating EmailJS) -->
<script>
  // anul Ã®n footer
  (function(){const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();})();

  // PF/PJ â€“ doar afiÈ™are + required pe cÃ¢mpurile PJ
  (function(){
    function sync(){
      const isPJ=(document.querySelector('input[name="tip"]:checked')||{}).value==='pj';
      document.querySelector('.pj-only').style.display = isPJ ? 'block' : 'none';
      document.querySelector('.pf-only').style.display = isPJ ? 'none'  : 'block';
      ['firma','cui','reg'].forEach(n=>{ const el=document.getElementById(n); if(el) el.required=isPJ; });
    }
    document.addEventListener('DOMContentLoaded', sync);
    document.querySelectorAll('input[name="tip"]').forEach(r=>r.addEventListener('change', sync));
  })();

  // blocare dublu-submit â€“ nu schimb logica ta de trimitere (EmailJS/proforma)
  (function(){
    const f=document.getElementById('order-form');
    const b=document.getElementById('place-order');
    if(!f||!b) return;
    let sent=false;
    f.addEventListener('submit',function(e){
      if(sent){ e.preventDefault(); return false; }
      sent=true; b.disabled=true; b.textContent='Se trimite...';
      // dacÄƒ trimiterea e gestionatÄƒ Ã®n alt script, acesta va prelua submit-ul
      // dacÄƒ apare o eroare, poÈ›i re-activa butonul manual:
      // b.disabled=false; b.textContent='PlaseazÄƒ comanda'; sent=false;
    },{capture:true});
  })();
</script>
</body>
</html>
