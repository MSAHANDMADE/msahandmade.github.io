<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Co»ô ‚Äî MSA Handmade</title>

  <!-- SEO -->
  <meta name="description" content="FinalizeazƒÉ comanda la MSA Handmade. VerificƒÉ produsele din co»ô »ôi completeazƒÉ datele de livrare." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://msahandmade.ro/cos.html" />
  <link rel="alternate" hreflang="ro" href="https://msahandmade.ro/cos.html" />

  <!-- OG / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="MSA Handmade" />
  <meta property="og:title" content="Co»ô ‚Äî MSA Handmade" />
  <meta property="og:description" content="FinalizeazƒÉ comanda la MSA Handmade." />
  <meta property="og:url" content="https://msahandmade.ro/cos.html" />
  <meta property="og:image" content="https://msahandmade.ro/logo.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Co»ô ‚Äî MSA Handmade" />
  <meta name="twitter:description" content="FinalizeazƒÉ comanda la MSA Handmade." />
  <meta name="twitter:image" content="https://msahandmade.ro/logo.png" />

  <link rel="stylesheet" href="styles.css" />

  <!-- pu»õin styling suplimentar, doar pentru co»ô -->
  <style>
    .container{max-width:1000px;margin:0 auto;padding:16px}
    .totals{display:flex;gap:16px;flex-wrap:wrap;margin:10px 0 20px}
    .pill{background:#f3f4f6;border-radius:999px;padding:10px 14px}
    .items{display:flex;flex-direction:column;gap:14px;margin:10px 0 24px}
    .item{display:grid;grid-template-columns:72px 1fr auto;gap:12px;align-items:center;background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:12px}
    .item img{width:72px;height:72px;object-fit:cover;border-radius:10px}
    .name{font-weight:600}
    .muted{color:#6b7280}
    .qty{display:flex;align-items:center;gap:8px}
    .qty button{width:36px;height:36px;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
    .qty input{width:56px;height:36px;border:1px solid #e5e7eb;border-radius:10px;text-align:center}
    .remove{border:0;background:#fee2e2;color:#b91c1c;border-radius:10px;padding:8px 10px}
    form .grid{display:grid;gap:12px}
    @media(min-width:720px){ form .grid{grid-template-columns:1fr 1fr} }
    label{font-size:14px;color:#374151}
    input[type="text"],input[type="email"],textarea{width:100%;height:42px;border:1px solid #e5e7eb;border-radius:10px;padding:8px 12px}
    textarea{min-height:100px}
    .actions{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
    .btn{background:#111827;color:#fff;border:0;border-radius:10px;padding:12px 18px;cursor:pointer}
    .btn.ghost{background:#f3f4f6;color:#111827}
    .error{color:#b91c1c;margin-top:8px}
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <a href="index.html">AcasƒÉ</a>
      <a href="produse.html">Produse</a>
      <a href="contact.html">Contact</a>
      <a href="cos.html" class="cart">üõí <span id="cart-count">0</span></a>
    </nav>
  </header>

  <main class="container">
    <h1>Co»ôul tƒÉu</h1>
    <p><a href="produse.html">‚Üê √énapoi la produse</a></p>

    <!-- totaluri -->
    <div class="totals">
      <div class="pill">Subtotal: <strong id="subtotal">0.00 RON</strong></div>
      <div class="pill">Livrare: <strong id="shipping">0.00 RON</strong></div>
      <div class="pill">Total: <strong id="total">0.00 RON</strong></div>
    </div>

    <!-- lista produse -->
    <div id="items" class="items"></div>

    <!-- formular -->
    <form id="order-form">
      <fieldset style="border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;margin-bottom:14px">
        <legend>Tip client</legend>
        <label><input type="radio" name="tip" value="PersoanƒÉ fizicƒÉ" checked /> PersoanƒÉ fizicƒÉ</label>
        &nbsp;&nbsp;&nbsp;
        <label><input type="radio" name="tip" value="PersoanƒÉ juridicƒÉ" /> PersoanƒÉ juridicƒÉ</label>
      </fieldset>

      <div class="grid">
        <div>
          <label>Nume</label>
          <input type="text" name="nume" required />
        </div>
        <div>
          <label>Prenume</label>
          <input type="text" name="prenume" required />
        </div>
        <div>
          <label>Email</label>
          <input type="email" name="email" required />
        </div>
        <div>
          <label>Telefon</label>
          <input type="text" name="telefon" required />
        </div>
        <div>
          <label>Jude»õ</label>
          <input type="text" name="judet" required />
        </div>
        <div>
          <label>Ora»ô</label>
          <input type="text" name="oras" required />
        </div>
        <div>
          <label>Cod po»ôtal</label>
          <input type="text" name="codpostal" required />
        </div>
        <div>
          <label>AdresƒÉ</label>
          <input type="text" name="adresa" required />
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Men»õiuni (op»õional)</label>
        <textarea name="mentiuni"></textarea>
      </div>

      <div class="actions">
        <button type="button" id="clear" class="btn ghost">Gole»ôte co»ôul</button>
        <button type="submit" class="btn">PlaseazƒÉ comanda</button>
      </div>
      <div id="form-error" class="error" style="display:none;"></div>
    </form>
  </main>

  <footer class="footer" style="text-align:center;margin-top:30px;padding:20px;color:#666;">
    <small>&copy; <span id="year"></span> ‚Äî MSA Handmade.</small>
  </footer>

  <!-- logica co»ôului -->
  <script src="cart.js"></script>
  <script src="script.js"></script>
  <script>
    // anul curent
    document.getElementById("year").textContent = new Date().getFullYear();

    // util: actualizeazƒÉ badge-ul
    function refreshCartCount(){
      try{
        const list = (window.MSACart && MSACart.readCart) ? MSACart.readCart() : [];
        const c = list.reduce((s,i)=>s+(i.qty||1),0);
        const el = document.getElementById("cart-count");
        if(el) el.textContent = c;
      }catch(e){}
    }

    // randare listƒÉ + totaluri
    function renderCart(){
      const itemsWrap = document.getElementById("items");
      const list = (window.MSACart && MSACart.readCart) ? MSACart.readCart() : [];
      itemsWrap.innerHTML = "";

      if(!list.length){
        itemsWrap.innerHTML = '<p class="muted">Co»ôul este gol.</p>';
      } else {
        list.forEach(p=>{
          const li = document.createElement("div");
          li.className = "item";
          li.innerHTML = `
            <img src="${p.image || 'logo.png'}" alt="${p.name || ''}">
            <div>
              <div class="name">${p.name || '-'}</div>
              <div class="muted">${Number(p.price||0).toFixed(2)} RON</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <div class="qty">
                <button type="button" data-act="dec" aria-label="Scade">‚àí</button>
                <input type="text" inputmode="numeric" value="${p.qty||1}" aria-label="Cantitate"/>
                <button type="button" data-act="inc" aria-label="Cre»ôte">+</button>
              </div>
              <button type="button" class="remove" aria-label="»òterge">»òterge</button>
            </div>
          `;
          // minus
          li.querySelector('[data-act="dec"]').addEventListener("click", ()=>{
            if(window.MSACart && MSACart.decreaseQty) MSACart.decreaseQty(p.id);
            renderCart();
          });
          // plus
          li.querySelector('[data-act="inc"]').addEventListener("click", ()=>{
            if(window.MSACart && MSACart.increaseQty) MSACart.increaseQty(p.id);
            renderCart();
          });
          // input cantitate (validare simplƒÉ)
          li.querySelector('input').addEventListener("change", (e)=>{
            let v = parseInt(e.target.value,10);
            if(isNaN(v) || v<1) v = 1;
            // setQty dacƒÉ existƒÉ, altfel cre»ôtem/scƒÉdem p√¢nƒÉ la v
            if(window.MSACart && MSACart.setQty){
              MSACart.setQty(p.id, v);
            } else {
              // fallback simplu:
              const cur = p.qty||1;
              const diff = v - cur;
              if(diff>0){ for(let i=0;i<diff;i++) MSACart.increaseQty && MSACart.increaseQty(p.id); }
              if(diff<0){ for(let i=0;i<Math.abs(diff);i++) MSACart.decreaseQty && MSACart.decreaseQty(p.id); }
            }
            renderCart();
          });
          // remove
          li.querySelector('.remove').addEventListener("click", ()=>{
            if(window.MSACart && MSACart.removeFromCart) MSACart.removeFromCart(p.id);
            renderCart();
          });

          itemsWrap.appendChild(li);
        });
      }

      // totaluri
      let totals = {subtotal:0, shipping:0, total:0};
      try{
        if(window.MSACart && MSACart.computeTotals) {
          totals = MSACart.computeTotals(list);
        } else {
          const subtotal = list.reduce((s,i)=>s + Number(i.price||0)*(i.qty||1), 0);
          const shipping = list.length ? 17 : 0;
          totals = {subtotal, shipping, total: subtotal + shipping};
        }
      }catch(e){}

      document.getElementById("subtotal").textContent = (totals.subtotal||0).toFixed(2) + " RON";
      document.getElementById("shipping").textContent = (totals.shipping||0).toFixed(2) + " RON";
      document.getElementById("total").textContent    = (totals.total||0).toFixed(2) + " RON";

      refreshCartCount();
    }

    // butoane mari
    document.getElementById("clear").addEventListener("click", ()=>{
      if(window.MSACart && MSACart.clearCart) MSACart.clearCart();
      renderCart();
    });

    // submit comandƒÉ
    document.getElementById("order-form").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const err = document.getElementById("form-error");
      err.style.display = "none"; err.textContent = "";

      try{
        if(!window.MSACart || !MSACart.submitOrder) throw new Error("Func»õia de trimitere nu este disponibilƒÉ.");
        const fd = new FormData(e.currentTarget);
        const ok = await MSACart.submitOrder(fd);   // √Æn cart.js ai deja emailjs.init + send
        if(ok){
          // dupƒÉ trimitere cart.js gole»ôte co»ôul ‚Üí redirect:
          window.location.href = "multumesc.html";
        }else{
          throw new Error("Nu s-a putut trimite comanda.");
        }
      }catch(ex){
        err.textContent = "Eroare la trimitere: " + (ex.message || ex);
        err.style.display = "block";
      }
    });

    // ini»õializare
    renderCart();
  </script>
</body>
</html>
