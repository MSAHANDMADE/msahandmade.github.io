<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coșul tău — MSA Handmade</title>

  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://msahandmade.ro/cos.html" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    .container{max-width:920px;margin:0 auto;padding:24px}
    .totals{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
    .pill{background:#f3f4f6;border-radius:999px;padding:8px 12px}
    .item{display:grid;grid-template-columns:72px 1fr auto auto;gap:12px;align-items:center;padding:12px;border-bottom:1px solid #eee}
    .item img{width:72px;height:72px;border-radius:10px;object-fit:cover;background:#fafafa}
    .qty{display:flex;align-items:center;gap:6px}
    .qty input{width:56px;padding:6px;border:1px solid #ddd;border-radius:8px;text-align:center}
    .btn{background:#111827;color:#fff;border:0;border-radius:10px;padding:12px 16px;cursor:pointer}
    .btn.secondary{background:#e5e7eb;color:#111827}
    form{display:grid;gap:12px;margin-top:18px}
    fieldset{border:1px solid #e5e7eb;border-radius:12px;padding:12px}
    label{display:block;font-weight:600;margin:6px 0 4px}
    input, textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.item{grid-template-columns:72px 1fr auto;grid-auto-rows:min-content}}
  </style>
  <!-- EmailJS SDK (obligatoriu pentru trimitere) -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <a href="index.html">Acasă</a>
      <a href="produse.html">Produse</a>
      <a href="contact.html">Contact</a>
      <a href="cos.html" class="cart">🛒 <span id="cart-count">0</span></a>
    </nav>
  </header>

  <main class="container">
    <h1>Coșul tău</h1>
    <p><a href="produse.html">← Înapoi la produse</a></p>

    <div class="totals">
      <span class="pill">Subtotal: <strong id="subtot">0 RON</strong></span>
      <span class="pill">Livrare: <strong id="shipping">17 RON</strong></span>
      <span class="pill">Total: <strong id="total">0 RON</strong></span>
    </div>

    <ul id="cart-list" style="list-style:none;padding:0;margin:0"></ul>

    <form id="order-form">
      <fieldset>
        <legend><strong>Tip client</strong></legend>
        <label><input type="radio" name="tip" value="Persoană fizică" checked /> Persoană fizică</label>
        <label><input type="radio" name="tip" value="Persoană juridică" /> Persoană juridică</label>
      </fieldset>

      <div class="row">
        <div>
          <label for="nume">Nume</label>
          <input id="nume" name="nume" required />
        </div>
        <div>
          <label for="prenume">Prenume</label>
          <input id="prenume" name="prenume" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required />
        </div>
        <div>
          <label for="telefon">Telefon</label>
          <input id="telefon" name="telefon" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="judet">Județ</label>
          <input id="judet" name="judet" required />
        </div>
        <div>
          <label for="oras">Oraș</label>
          <input id="oras" name="oras" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="codpostal">Cod poștal</label>
          <input id="codpostal" name="codpostal" required />
        </div>
        <div>
          <label for="adresa">Adresă</label>
          <input id="adresa" name="adresa" required />
        </div>
      </div>

      <div>
        <label for="mentiuni">Mențiuni (opțional)</label>
        <textarea id="mentiuni" name="mentiuni" rows="4"></textarea>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:6px">
        <button type="button" id="clear" class="btn secondary">Golește coșul</button>
        <button type="submit" class="btn">Plasează comanda</button>
      </div>
    </form>
  </main>

  <footer class="footer" style="text-align:center; padding:20px; color:#666;">
    <small>&copy; <span id="year"></span> — MSA Handmade.</small>
  </footer>

  <script src="cart.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Randează coșul în pagină
    function renderCart(){
      const list = (window.MSACart?.readCart?.() || []);
      const ul = document.getElementById('cart-list');
      ul.innerHTML = '';

      list.forEach((it, idx)=>{
        const li = document.createElement('li');
        li.className = 'item';

        const img = document.createElement('img');
        img.src = it.image || 'logo.png';
        img.alt = it.name || '';
        li.appendChild(img);

        const title = document.createElement('div');
        title.innerHTML = `<div style="font-weight:600">${it.name || 'Produs'}</div><div>${(Number(it.price)||0).toFixed(2)} RON</div>`;
        li.appendChild(title);

        const qty = document.createElement('div');
        qty.className = 'qty';
        const minus = document.createElement('button');
        minus.type='button'; minus.className='btn secondary'; minus.textContent='−';
        minus.onclick=()=>{ MSACart.decreaseQty(idx); renderCart(); };

        const input = document.createElement('input');
        input.type='number'; input.min='1'; input.value=it.qty||1;
        input.onchange=()=>{ MSACart.setQty(idx, parseInt(input.value,10)||1); renderCart(); };

        const plus = document.createElement('button');
        plus.type='button'; plus.className='btn secondary'; plus.textContent='+';
        plus.onclick=()=>{ MSACart.increaseQty(idx); renderCart(); };

        qty.append(minus,input,plus);
        li.appendChild(qty);

        const del = document.createElement('button');
        del.type='button'; del.className='btn secondary'; del.textContent='Șterge';
        del.onclick=()=>{ MSACart.removeFromCart(idx); renderCart(); };
        li.appendChild(del);

        ul.appendChild(li);
      });

      // totaluri
      const t = MSACart.computeTotals(list);
      document.getElementById('subtot').textContent = `${t.subtotal.toFixed(2)} RON`;
      document.getElementById('shipping').textContent = `${t.shipping.toFixed(2)} RON`;
      document.getElementById('total').textContent = `${t.total.toFixed(2)} RON`;

      // badge
      MSACart.updateCartCountBadge();
    }
    renderCart();

    document.getElementById('clear').onclick = ()=>{ MSACart.clearCart(); renderCart(); };

    // submit
    document.getElementById('order-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      try{
        await MSACart.submitOrder(new FormData(e.target));
        window.location.href = 'multumesc.html';
      }catch(err){
        alert('Eroare la trimitere: ' + (err?.message || err || 'necunoscută'));
      }
    });
  </script>
</body>
</html>
