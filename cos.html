<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CoÈ™ â€” MSA Handmade</title>
<link rel="stylesheet" href="styles.css" />
<style>
  :root{--ink:#0b132b;--muted:#64748b;--line:#e5e7eb;--card:#fff;--brand:#0b132b}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#fafafa;color:var(--ink)}
  a{text-decoration:none;color:inherit}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  header.nav{display:flex;gap:18px;align-items:center;justify-content:space-between;padding:12px 0}
  nav a{font-weight:700;margin-right:18px}
  .pill{background:#fde68a;border-radius:999px;padding:4px 10px;font-weight:800}
  h1{font-size:clamp(28px,4vw,40px);margin:8px 0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 4px 18px rgba(2,8,23,.06);padding:16px}
  .tbl-wrap{overflow-x:auto}
  table.cart{width:100%;border-collapse:collapse;table-layout:auto}
  table.cart th,table.cart td{padding:12px;border-bottom:1px solid var(--line);vertical-align:middle}
  table.cart th{background:#f8fafc;text-align:left;white-space:nowrap}
  .cart-line{display:grid;grid-template-columns:72px 1fr;gap:12px;align-items:center}
  .cart-thumb{width:72px;height:72px;border-radius:12px;object-fit:cover;border:1px solid var(--line)}
  .name{display:block;line-height:1.25;word-break:break-word;font-weight:800}
  .unit{color:var(--muted);font-weight:700;margin-top:4px}
  /* Cantitate */
  .qty{display:inline-flex;align-items:center;border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .qty button{width:42px;height:42px;border:0;background:#f1f5f9;font-size:22px;font-weight:800;line-height:1;cursor:pointer}
  .qty input[type="number"]{width:66px;height:42px;border:0;text-align:center;font-weight:800;font-size:18px}
  table.cart th:nth-child(2), table.cart td:nth-child(2){min-width:150px;text-align:center;white-space:nowrap}
  table.cart th:nth-child(3), table.cart td:nth-child(3){min-width:110px;text-align:right;white-space:nowrap}
  @media (max-width:420px){
    .qty button{width:36px;height:36px;font-size:20px}
    .qty input[type="number"]{width:54px;height:36px;font-size:16px}
    table.cart th:nth-child(2), table.cart td:nth-child(2){min-width:130px}
    table.cart th:nth-child(3), table.cart td:nth-child(3){min-width:96px}
  }
  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
  .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:#fff;font-weight:700;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;border-color:transparent}
  .btn.danger{background:#fee2e2;color:#991b1b;border-color:#fecaca}
  .btn[disabled]{opacity:.55;pointer-events:none}
  .totals{display:grid;gap:8px}
  .row{display:flex;justify-content:space-between}
  .grand{font-weight:900;font-size:22px}
  form input, form textarea{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font-size:16px;margin-bottom:10px;background:#fff}
  .switch{display:flex;gap:18px;margin:6px 0 12px}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:700px){.two{grid-template-columns:1fr}}
  .pf-only{display:block}
  .pj-only{display:none}
</style>
</head>
<body>
<div class="wrap">
  <header class="nav">
    <nav>
      <a href="index.html">AcasÄƒ</a>
      <a href="produse.html">Produse</a>
      <a href="despre.html">Despre</a>
      <a href="contact.html">Contact</a>
    </nav>
    <a href="cos.html" aria-label="CoÈ™">ðŸ›’ <span id="cart-count" class="pill">0</span></a>
  </header>

  <h1>CoÈ™ul tÄƒu</h1>

  <!-- LISTÄ‚ PRODUSE -->
  <section class="card">
    <div class="tbl-wrap">
      <table class="cart" aria-label="Produse Ã®n coÈ™">
        <thead>
          <tr>
            <th>Produs</th>
            <th style="text-align:center">Cant.</th>
            <th style="text-align:right">Total</th>
          </tr>
        </thead>
        <tbody id="cart-items">
          <tr><td colspan="3" class="muted">Se Ã®ncarcÄƒâ€¦</td></tr>
        </tbody>
      </table>
    </div>
    <div class="actions">
      <button id="clear-cart" class="btn danger" type="button">GoleÈ™te coÈ™ul</button>
      <a class="btn" href="produse.html">ContinuÄƒ cumpÄƒrÄƒturile</a>
    </div>
  </section>

  <!-- TOTALURI -->
  <section class="card" style="margin-top:16px">
    <h2 style="margin:0 0 8px">Totaluri</h2>
    <div class="totals">
      <div class="row"><span>Subtotal</span><span id="subval">0.00 RON</span></div>
      <div class="row"><span>Reducere</span><span id="discval">âˆ’ 0.00 RON</span></div>
      <div class="row"><span>Livrare</span><span id="shipval">0.00 RON</span></div>
      <hr />
      <div class="row grand"><span>Total</span><span id="totval">0.00 RON</span></div>
    </div>
  </section>

  <!-- FORMULAR -->
  <section class="card" style="margin-top:16px">
    <h2 style="margin:0 0 8px">Detalii pentru livrare</h2>

    <form id="order-form">
      <div class="switch">
        <label><input type="radio" name="tip" value="pf" checked> PersoanÄƒ fizicÄƒ</label>
        <label><input type="radio" name="tip" value="pj"> PersoanÄƒ juridicÄƒ</label>
      </div>

      <div class="pf-only two">
        <input id="nume"    name="nume"    placeholder="Nume" required>
        <input id="prenume" name="prenume" placeholder="Prenume" required>
      </div>

      <div class="pj-only" id="pj-box">
        <input id="firma" name="firma" placeholder="Denumire firmÄƒ">
        <div class="two">
          <input id="cui"   name="cui"   placeholder="CUI">
          <input id="reg"   name="reg"   placeholder="Nr. Reg. ComerÈ›">
        </div>
      </div>

      <div class="two">
        <input id="email"   name="email"   placeholder="Email" required>
        <input id="telefon" name="telefon" placeholder="Telefon" required>
      </div>
      <div class="two">
        <input id="judet"   name="judet"   placeholder="JudeÈ›" required>
        <input id="oras"    name="oras"    placeholder="OraÈ™" required>
      </div>
      <input id="adresa"  name="adresa"  placeholder="AdresÄƒ completÄƒ" required>
      <input id="zip"     name="zip"     placeholder="Cod poÈ™tal">
      <textarea id="mentiuni" name="mentiuni" placeholder="MenÈ›iuni (opÈ›ional)" rows="3"></textarea>

      <!-- cÃ¢mpuri ascunse trimise la EmailJS/proforma -->
      <textarea id="cart_json" name="cart_json" hidden></textarea>
      <input   id="cart_total" name="cart_total" type="hidden" />

      <button id="place-order" type="submit" class="btn primary" style="width:100%;margin-top:8px">
        PlaseazÄƒ comanda
      </button>
    </form>
  </section>

  <footer style="text-align:center;margin:26px 0;color:#6b7280">
    Â© <span id="year"></span> â€” MSA Handmade. Toate drepturile rezervate.
  </footer>
</div>

<script>
/* ===== CoÈ™ AUTOSUFICIENT Ã®n cos.html (fÄƒrÄƒ alte fiÈ™iere) ===== */
(function(){
  const KEYS = ['MSA_CART','msa_cart','CART','CART_ITEMS'];
  const $ = s => document.querySelector(s);
  const toNum = v => { const n=Number(v); return isFinite(n)&&!isNaN(n)?n:0; };
  const fmt = x => toNum(x).toFixed(2)+' RON';

  function readAny(){
    for(const k of KEYS){
      try{
        const raw = localStorage.getItem(k);
        if(!raw) continue;
        const data = JSON.parse(raw);
        if(Array.isArray(data) && data.length) return data.map(n=>({
          id: String(n.id || n.productId || ''),
          name: n.name || n.title || '',
          price: toNum(n.price || n.unitPrice || n.amount || 0),
          image: n.image || n.img || '',
          qty: Math.max(1, toNum(n.qty || n.quantity || 1))
        }));
      }catch(e){}
    }
    return [];
  }

  function writeCanon(items){
    try{ localStorage.setItem('MSA_CART', JSON.stringify(items||[])); }catch(e){}
  }

  function calc(items){
    const sub = items.reduce((s,i)=>s+toNum(i.price)*toNum(i.qty),0);
    let disc=0; if(sub>=400) disc=sub*0.20; else if(sub>=300) disc=sub*0.15; else if(sub>=200) disc=sub*0.10;
    const ship = (sub-disc)>=300 ? 0 : 0;
    const tot = Math.max(0, sub-disc+ship);
    return {sub,disc,ship,tot};
  }

  function updateBadge(items){
    const el = $('#cart-count'); if(!el) return;
    const c = items.reduce((s,i)=>s+toNum(i.qty),0);
    el.textContent = c;
  }

  function render(){
    let items = readAny();
    writeCanon(items); // normalizÄƒm Ã®n MSA_CART pentru consistenÈ›Äƒ
    const tb = $('#cart-items');
    tb.innerHTML = '';
    if(!items.length){
      tb.innerHTML = '<tr><td colspan="3" class="muted">CoÈ™ul este gol.</td></tr>';
      fillTotals({sub:0,disc:0,ship:0,tot:0});
      updateBadge(items);
      syncHidden(items);
      return;
    }

    items.forEach(it=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <div class="cart-line">
            ${it.image ? `<img class="cart-thumb" src="${it.image}" alt="${it.name}">` : `<div></div>`}
            <div>
              <span class="name">${it.name}</span>
              <div class="unit">${fmt(it.price)}</div>
            </div>
          </div>
        </td>
        <td style="text-align:center">
          <div class="qty">
            <button class="qminus" aria-label="Scade">âˆ’</button>
            <input type="number" min="1" value="${toNum(it.qty)}" />
            <button class="qplus" aria-label="CreÈ™te">+</button>
          </div>
        </td>
        <td style="text-align:right"><strong>${fmt(it.price*it.qty)}</strong></td>
      `;
      const input = tr.querySelector('input');
      tr.querySelector('.qminus').addEventListener('click', ()=>{
        input.value = Math.max(1, toNum(input.value)-1);
        it.qty = toNum(input.value); saveAndRerender();
      });
      tr.querySelector('.qplus').addEventListener('click', ()=>{
        input.value = toNum(input.value)+1;
        it.qty = toNum(input.value); saveAndRerender();
      });
      input.addEventListener('change', ()=>{
        input.value = Math.max(1, toNum(input.value));
        it.qty = toNum(input.value); saveAndRerender();
      });
      tb.appendChild(tr);
    });

    fillTotals(calc(items));
    updateBadge(items);
    syncHidden(items);

    function saveAndRerender(){
      // citim iar, actualizÄƒm itemul curent dupÄƒ id, salvÄƒm canonic È™i reafiÈ™Äƒm
      let cur = readAny();
      const idx = cur.findIndex(x=>x.id===it.id);
      if(idx>=0) cur[idx].qty = it.qty;
      KEYS.forEach(k=>localStorage.setItem(k, JSON.stringify(cur)));
      render();
    }
  }

  function fillTotals(t){
    const set = (id,val)=>{ const el=document.getElementById(id); if(el) el.textContent=val; };
    set('subval', fmt(t.sub));
    set('discval','âˆ’ '+fmt(t.disc));
    set('shipval', fmt(t.ship));
    set('totval',  fmt(t.tot));
  }

  function syncHidden(items){
    const t = calc(items);
    const area = document.getElementById('cart_json');
    const tot  = document.getElementById('cart_total');
    if(area){
      area.value = JSON.stringify(items.map(i=>({
        id:i.id, name:i.name, price:toNum(i.price), qty:toNum(i.qty), line:toNum(i.price)*toNum(i.qty)
      })));
    }
    if(tot){ tot.value = t.tot.toFixed(2); }
  }

  // GoleÈ™te coÈ™ul
  document.getElementById('clear-cart')?.addEventListener('click', ()=>{
    KEYS.forEach(k=>localStorage.setItem(k,'[]'));
    render();
  });

  // PF/PJ toggle
  (function(){
    function sync(){
      const isPJ=(document.querySelector('input[name="tip"]:checked')||{}).value==='pj';
      document.querySelector('.pj-only').style.display = isPJ ? 'block' : 'none';
      document.querySelector('.pf-only').style.display = isPJ ? 'none'  : 'block';
      ['firma','cui','reg'].forEach(n=>{ const el=document.getElementById(n); if(el) el.required=isPJ; });
    }
    document.addEventListener('DOMContentLoaded', sync);
    document.querySelectorAll('input[name="tip"]').forEach(r=>r.addEventListener('change', sync));
  })();

  // anul Ã®n footer
  (function(){ const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear(); })();

  // re-render pe schimbÄƒri din alt tab
  window.addEventListener('storage', e=>{
    if(e && KEYS.includes(e.key)) render();
  });

  // Init
  document.addEventListener('DOMContentLoaded', render);
})();
</script>
</body>
</html>
