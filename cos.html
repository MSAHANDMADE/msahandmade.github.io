<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Co»ôul tƒÉu ‚Äî MSA Handmade</title>

  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://msahandmade.ro/cos.html" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    .container{max-width:960px;margin:0 auto;padding:24px}
    .totals{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
    .pill{background:#f3f4f6;border-radius:999px;padding:8px 12px}
    .muted{color:#6b7280}
    .list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:12px}
    .item{display:grid;grid-template-columns:72px 1fr auto auto;gap:12px;align-items:center;background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:12px}
    .item img{width:72px;height:72px;border-radius:10px;object-fit:cover;background:#fafafa}
    .name{font-weight:600}
    .qty{display:flex;align-items:center;gap:6px}
    .qty input{width:56px;padding:8px;border:1px solid #e5e7eb;border-radius:10px;text-align:center}
    .btn{background:#111827;color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.secondary{background:#e5e7eb;color:#111827}
    form{display:grid;gap:12px;margin-top:18px}
    fieldset{border:1px solid #e5e7eb;border-radius:12px;padding:12px}
    label{display:block;font-weight:600;margin:6px 0 4px}
    input, textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.item{grid-template-columns:72px 1fr auto;grid-auto-rows:min-content}}
  </style>

  <!-- EmailJS SDK (obligatoriu) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <a href="index.html">AcasƒÉ</a>
      <a href="produse.html">Produse</a>
      <a href="contact.html">Contact</a>
      <a href="cos.html" class="cart">üõí <span id="cart-count">0</span></a>
    </nav>
  </header>

  <main class="container">
    <h1>Co»ôul tƒÉu</h1>
    <p><a href="produse.html">‚Üê √énapoi la produse</a></p>

    <div class="totals">
      <span class="pill">Subtotal: <strong id="subtot">0.00 RON</strong></span>
      <span class="pill">Livrare: <strong id="shipping">17.00 RON</strong></span>
      <span class="pill">Reducere: <strong id="discount-line">0.00 RON</strong></span>
      <span class="pill">Total: <strong id="total">0.00 RON</strong></span>
    </div>

    <!-- cod reducere -->
    <div style="margin:12px 0 20px">
      <label for="discount">Cod de reducere (ex: REDUCERE10 / REDUCERE15)</label>
      <input id="discount" name="discount" placeholder="Introdu codul" style="padding:10px;border:1px solid #ccc;border-radius:8px;width:240px;">
      <button type="button" class="btn secondary" id="apply-discount">AplicƒÉ</button>
      <span class="muted" id="discount-status"></span>
    </div>

    <ul id="cart-list" class="list"></ul>

    <form id="order-form">
      <fieldset>
        <legend><strong>Tip client</strong></legend>
        <label><input type="radio" name="tip" value="PersoanƒÉ fizicƒÉ" checked /> PersoanƒÉ fizicƒÉ</label>
        <label><input type="radio" name="tip" value="PersoanƒÉ juridicƒÉ" /> PersoanƒÉ juridicƒÉ</label>
      </fieldset>

      <div class="row">
        <div><label>Nume</label><input name="nume" required /></div>
        <div><label>Prenume</label><input name="prenume" required /></div>
      </div>
      <div class="row">
        <div><label>Email</label><input name="email" type="email" required /></div>
        <div><label>Telefon</label><input name="telefon" required /></div>
      </div>
      <div class="row">
        <div><label>Jude»õ</label><input name="judet" required /></div>
        <div><label>Ora»ô</label><input name="oras" required /></div>
      </div>
      <div class="row">
        <div><label>Cod po»ôtal</label><input name="codpostal" required /></div>
        <div><label>AdresƒÉ</label><input name="adresa" required /></div>
      </div>
      <div>
        <label>Men»õiuni (op»õional)</label>
        <textarea name="mentiuni" rows="4"></textarea>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:6px">
        <button type="button" id="clear" class="btn secondary">Gole»ôte co»ôul</button>
        <button type="submit" class="btn">PlaseazƒÉ comanda</button>
      </div>
    </form>
  </main>

  <footer class="footer" style="text-align:center; padding:20px; color:#666;">
    <small>&copy; <span id="year"></span> ‚Äî MSA Handmade.</small>
  </footer>

  <script src="cart.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function renderCart(){
      const list = (window.MSACart?.readCart?.() || []);
      const ul = document.getElementById('cart-list');
      ul.innerHTML = '';

      if (!list.length){
        ul.innerHTML = '<li class="muted">Co»ôul este gol.</li>';
      } else {
        list.forEach((it, idx)=>{
          const li = document.createElement('li');
          li.className = 'item';

          const img = document.createElement('img');
          img.src = it.image || 'logo.png';
          img.alt = it.name || '';
          li.appendChild(img);

          const title = document.createElement('div');
          title.innerHTML = `<div class="name">${it.name || 'Produs'}</div><div class="muted">${(Number(it.price)||0).toFixed(2)} RON</div>`;
          li.appendChild(title);

          const qty = document.createElement('div');
          qty.className = 'qty';
          const minus = document.createElement('button');
          minus.type='button'; minus.className='btn secondary'; minus.textContent='‚àí';
          minus.onclick=()=>{ MSACart.decreaseQty(idx); setTimeout(renderCart,50); };

          const input = document.createElement('input');
          input.type='number'; input.min='1'; input.value=it.qty||1;
          input.onchange=()=>{ MSACart.setQty(idx, parseInt(input.value,10)||1); setTimeout(renderCart,50); };

          const plus = document.createElement('button');
          plus.type='button'; plus.className='btn secondary'; plus.textContent='+';
          plus.onclick=()=>{ MSACart.increaseQty(idx); setTimeout(renderCart,50); };

          qty.append(minus,input,plus);
          li.appendChild(qty);

          const del = document.createElement('button');
          del.type='button'; del.className='btn secondary'; del.textContent='»òterge';
          del.onclick=()=>{ MSACart.removeFromCart(idx); setTimeout(renderCart,50); };
          li.appendChild(del);

          ul.appendChild(li);
        });
      }

      const t = MSACart.computeTotals(list);
      document.getElementById('subtot').textContent = `${t.subtotal.toFixed(2)} RON`;
      document.getElementById('shipping').textContent = `${t.shipping.toFixed(2)} RON`;
      document.getElementById('discount-line').textContent = `‚àí${t.reducere.toFixed(2)} RON`;
      document.getElementById('total').textContent = `${t.total.toFixed(2)} RON`;

      MSACart.updateCartCountBadge();
    }
    renderCart();

    document.getElementById('clear').onclick = ()=>{ MSACart.clearCart(); renderCart(); };

    // aplicare reducere
    document.getElementById('apply-discount').onclick = ()=>{
      const code = document.getElementById('discount').value;
      const pct = MSACart.applyDiscount(code); // √Æntoarce procentul
      const s = document.getElementById('discount-status');
      s.textContent = pct ? `Reducere aplicatƒÉ: ${pct}%` : 'Cod invalid sau neactiv.';
      renderCart();
    };

    // submit comandƒÉ
    document.getElementById('order-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      try{
        await MSACart.submitOrder(new FormData(e.target));
        window.location.href = 'multumesc.html';
      }catch(err){
        alert('Eroare la trimitere: ' + (err?.message || err || 'necunoscutƒÉ'));
      }
    });
  </script>
</body>
</html>
